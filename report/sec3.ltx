\section{Метод разложения Магнуса для численного решения}

Полученное уравнение нейтринных осцилляций \eqref{eq:6} невообразимо сложно
исследовать в его аналитической форме, в добавок, оно имеет важную особенность —
оно является матричным и это ещё больше усложняет его решение. Для случае
скаляров было бы логично использовать метод итераций, однако для матричного
случая условием применимости данного метода является
\begin{equation}
	[H(t_{1}),H(t_{2})]=0, \forall t_{1},t_{2}.
\end{equation}
В общем случае это условие не выполняется, поэтому для решения этого уравнения
пользуются методами численного интегрирования. В рамках данной задачи наилучшим
методом выступает метод разложения Магнуса. Этот метод относится к
геометрическим интеграторам. Его особенностью является то, что приближенное
решение, предоставляемое процедурой, разделяет с точным решением соответствующие
геометрические свойства. Для нашего случая этим свойством является унитарность
оператора эволюции. Это необходимо для сохранения нормировки волновой функции.

Пусть дано матричное дифференциальное уравнения вида
\begin{equation}\label{eq:7}
	\frac{\dd}{\dd t}Y(t)=A(t)Y(t), \qquad A \in C^{n\times n}, \quad Y\in C^{n},
\end{equation}
при начальном условии \(Y(t_{0})=Y_{0}\), подход Магнуса заключается в поиске
экспоненциального представления решения
\begin{equation}
	Y(t)=\exp^{\Omega(t,t_{0})}Y_{0}, \qquad \Omega(t,t_{0})\in C^{n\times n}, \quad
	\Omega(t_{0},t_{0})=0.
\end{equation}
Когда матричные элементы \(A\) не зависят от \(t\), тогда \(\Omega(t,t_{0})=(t-t_{0})A\). В общем
случае, \(\Omega(t,t_{0})\) задаётся в виде ряда
\begin{equation}
	\Omega(t,t_{0})=\sum_{k=1}^{\infty}\Omega_{k}(t,t_{0}), \qquad \Omega(t_{0},t_{0}),
\end{equation}
где слагаемое \(\Omega_{k}\) составлено из нескольких интегралов вложенных коммутаторов
\(k\) матриц \(A\), вычисленных в \(k\) разных моментов времени. Первые три слагаемые
запишутся так
\begin{flalign}
	\Omega_{1}(t,t_{0})&=\int_{t_{0}}^{t} \dd t_{1} A_{1},\\
	\Omega_{2}(t,t_{0})&=\frac{1}{2}\int_{t_{0}}^{t}\dd
	t_{1}\int_{t_{0}}^{t_{1}}\dd t_{2}[A_{1},A_{2}],\\
	\Omega_{3}(t,t_{0})&=\frac{1}{6}\int_{t_{0}}^{t}\dd
	t_{1}\int_{t_{0}}^{t_{1}}\dd
	t_{2}\int_{t_{0}}^{t_{2}}\{[A_{1},[A_{2},A_{3}]]+[[A_{1},A_{2}],A_{3}]\}.
\end{flalign}

Так как вычисление конечного выражения бесконечного ряда Магнуса не
представляется целесообразным,
прибегают к наиболее оптимальным вариантам приближенного вычисления.

Используя разложение Магнуса в качестве числового интегратора, который даёт решение
\(\Psi(t)\), начиная с \(\Psi(t_{0})\), возникает вопрос, как эффективно обрабатывать один шаг
интегрирования.

Отдельные точки, в которых вычисляется решение на интервале \([t_{0},t_{f}]\), \(t_{0} < t_{1} <
\dots < t_{N}=t_{f}\) связанны с приращением времени на величину \(h_{n}=t_{n+1}-t_{n}\), где
\(0\leqslant n\leqslant N-1\).

Определим решение в точке \(t_{n+1}\)
\begin{equation}
	\Psi(t_{n+1})=\exp^{\Omega(t_{n}+h_{n},t_{n})}\Psi(t_{n}).
\end{equation}
После всех итераций, решение в конечной точке интервала даёт
\begin{equation}
	\Psi(t_{f})=\prod^{N-1}_{n=0}\exp^{\Omega(t_{n};h_{n})}\Psi(t_{0}), \qquad
	\Omega(t_{n};h_{n})\equiv\Omega(t_{n}+h_{n},t_{n}).
\end{equation}

Уравнение нейтринных осцилляций является одним из типов уравнений \eqref{eq:7}, где
\(n=3, t=r, A\equiv-\imath H\).
\begin{equation}
	\imath\frac{\dd}{\dd r}\Psi(r)=H(r)\Psi(r).
\end{equation}

Обозначим за \(r'\) порядок точности решения по степеням \(h_{n}\). Другими словами,
решение в точки \(\Psi(\xi_{n}+h_{n})\) вычисляется с точностью до \(O(h^{r'+1}_{n})\). За этот
порядок отвечает то, какой приближенный метод будет использоваться для нахождения
\(\Omega_{k}\) и какое значение \(k\) в ряде Магнуса будет принято последним.
Приближение
к усечённому ряду Магнуса порядка \(r'\):
\(\Omega(\xi_{n};h_{n})\simeq\Omega^{[r']}(\xi_{n};h_{n})\).

Таким образом, решение порядка точности \(r'\) по \(h_{n}\) будет реализовано следующей
формулой
\begin{equation}
	\Psi(\xi_{n})=\exp^{\Omega^{[r']}(\xi_{n};h_{n})}\Psi(\xi_{n}).
\end{equation}

Далее рассмотрим два метода реализации, где \(r'=2,4\), названные соответственно
M2 и M4.

\subsection{Алгоритм M2}

Метод приближения второго порядка является самым простым, так как из ряда Магнуса
остаётся только первое слагаемое \(\Omega^{[2]}=\Omega_{1}\)
\begin{equation}\label{eq:8}
	\Omega_{1}(\xi_{n};h_{n})=-\imath\int_{\xi_{n}}^{\xi_{n}+h_{n}}\dd t H(t),
\end{equation}
и для достижения заданной точности достаточно аппроксимировать интеграл
\eqref{eq:8} одной
точкой.

Таким образом, второй порядок точности реализуется формулой
\begin{equation}
	\Omega^{[2]}(\xi_{n})=-\imath H(\overline{\xi})h_{n}=-\imath(H_{0}+\overline{\upsilon}W)h_{n},
\end{equation}
где взята средняя точка интервала интегрирования
\(\overline{\xi}\equiv\xi_{n}+\frac{h_{n}}{2}\). Величина
\(\overline{\upsilon}\equiv\upsilon(\overline{\xi})\) пересчитывается на каждом
шаге.

\subsection{Алгоритм M4}

Для достижения порядка точности \(r'=4\) необходимо считать первые два члена разложения
\(\Omega^{[4]}=\Omega_{1}+\Omega_{2}\), а аппроксимировать интегралы двухточечными
квадратурами Гаусса-Лежандра.

Точки вычисления квадратур
\begin{equation}
	\xi_{\pm}=\xi_{n}+\Big(1\pm \frac{1}{\sqrt{3}}\Big)\frac{h_{n}}{2},
\end{equation}
в которых определены величины \(H_{\pm}=H(\xi_{\pm})\).

Конечная формула такого метода сводится к следующему выражению
\begin{equation}
	\Omega^{[4]}(\xi_{n};h_{n})=-\imath(H_{+}+H_{-})\frac{h_{n}}{2}+\frac{\sqrt{3}}{12}[H_{-},H_{+}]h_{n}^{2}.
\end{equation}
Эквивалентное приближение также можно получить с помощью квадратур Симпсона.

В данной работе была использована программа на основе алгоритма M4. Для контроля
качества численного решения сравнивался расчёт по алгоритму M2.

